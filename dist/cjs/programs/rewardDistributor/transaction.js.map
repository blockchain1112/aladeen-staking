{"version":3,"file":"transaction.js","sourceRoot":"","sources":["../../../../src/programs/rewardDistributor/transaction.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  findAta,\n  tryGetAccount,\n  withFindOrInitAssociatedTokenAccount,\n} from \"@cardinal/common\";\nimport type { web3 } from \"@project-serum/anchor\";\nimport { BN } from \"@project-serum/anchor\";\nimport type { Wallet } from \"@project-serum/anchor/dist/cjs/provider\";\nimport { TOKEN_PROGRAM_ID } from \"@solana/spl-token\";\nimport type { Connection, PublicKey, Transaction } from \"@solana/web3.js\";\nimport { SystemProgram } from \"@solana/web3.js\";\n\nimport { getRewardDistributor, getRewardEntry } from \"./accounts\";\nimport {\n  REWARD_MANAGER,\n  RewardDistributorKind,\n  rewardDistributorProgram,\n} from \"./constants\";\nimport {\n  findRewardAuthority,\n  findRewardDistributorId,\n  findRewardEntryId,\n} from \"./pda\";\nimport { withRemainingAccountsForKind } from \"./utils\";\n\nexport const withInitRewardDistributor = async (\n  transaction: Transaction,\n  connection: Connection,\n  wallet: Wallet,\n  params: {\n    distributorId: BN;\n    stakePoolId: PublicKey;\n    rewardMintId: PublicKey;\n    rewardAmount?: BN;\n    rewardDurationSeconds?: BN;\n    kind?: RewardDistributorKind;\n    maxSupply?: BN;\n    supply?: BN;\n    defaultMultiplier?: BN;\n    multiplierDecimals?: number;\n    maxRewardSecondsReceived?: BN;\n  }\n): Promise<[Transaction, web3.PublicKey]> => {\n  const rewardAuthority = findRewardAuthority(wallet.publicKey);\n\n  const rewardDistributorId = findRewardDistributorId(\n    params.stakePoolId,\n    params.distributorId\n  );\n  const remainingAccountsForKind = await withRemainingAccountsForKind(\n    transaction,\n    connection,\n    wallet,\n    rewardAuthority,\n    params.kind || RewardDistributorKind.Mint,\n    params.rewardMintId\n  );\n  const program = rewardDistributorProgram(connection, wallet);\n  const ix = await program.methods\n    .initRewardDistributor({\n      rewardAmount: params.rewardAmount || new BN(1),\n      rewardDurationSeconds: params.rewardDurationSeconds || new BN(1),\n      maxSupply: params.maxSupply || null,\n      supply: params.supply || null,\n      kind: params.kind || RewardDistributorKind.Mint,\n      defaultMultiplier: params.defaultMultiplier || null,\n      multiplierDecimals: params.multiplierDecimals || null,\n      maxRewardSecondsReceived: params.maxRewardSecondsReceived || null,\n      distributorIndex: params.distributorId.toNumber(),\n    })\n    .accounts({\n      rewardDistributor: rewardDistributorId,\n      rewardAuthority,\n      stakePool: params.stakePoolId,\n      rewardMint: params.rewardMintId,\n      authority: wallet.publicKey,\n      payer: wallet.publicKey,\n      tokenProgram: TOKEN_PROGRAM_ID,\n      systemProgram: SystemProgram.programId,\n    })\n    .remainingAccounts(remainingAccountsForKind)\n    .instruction();\n  const initRewardAuthorityIx = await program.methods\n    .initRewardAuthority({})\n    .accounts({\n      rewardAuthority,\n      authority: wallet.publicKey,\n      payer: wallet.publicKey,\n      systemProgram: SystemProgram.programId,\n    })\n    .instruction();\n  transaction.add(initRewardAuthorityIx);\n\n  transaction.add(ix);\n  return [transaction, rewardDistributorId];\n};\n\nexport const withInitRewardEntry = async (\n  transaction: Transaction,\n  connection: Connection,\n  wallet: Wallet,\n  params: {\n    stakeEntryId: PublicKey;\n    rewardDistributorId: PublicKey;\n  }\n): Promise<[Transaction, PublicKey]> => {\n  const rewardEntryId = findRewardEntryId(\n    params.rewardDistributorId,\n    params.stakeEntryId\n  );\n  const program = rewardDistributorProgram(connection, wallet);\n  const ix = await program.methods\n    .initRewardEntry()\n    .accounts({\n      rewardEntry: rewardEntryId,\n      stakeEntry: params.stakeEntryId,\n      rewardDistributor: params.rewardDistributorId,\n      payer: wallet.publicKey,\n      systemProgram: SystemProgram.programId,\n    })\n    .instruction();\n  transaction.add(ix);\n  return [transaction, rewardEntryId];\n};\n\nexport const withClaimRewards = async (\n  transaction: Transaction,\n  connection: Connection,\n  wallet: Wallet,\n  params: {\n    distributorId: BN;\n    stakePoolId: PublicKey;\n    stakeEntryId: PublicKey;\n    lastStaker: PublicKey;\n    payer?: PublicKey;\n    skipRewardMintTokenAccount?: boolean;\n    authority?: PublicKey;\n  }\n): Promise<Transaction> => {\n  const rewardDistributorId = findRewardDistributorId(\n    params.stakePoolId,\n    params.distributorId\n  );\n  const rewardDistributorData = await tryGetAccount(() =>\n    getRewardDistributor(connection, rewardDistributorId)\n  );\n  const rewardAuthority = rewardDistributorData?.parsed.rewardAuthority;\n\n  const rewardMintTokenAccountId = params.skipRewardMintTokenAccount\n    ? await findAta(\n        rewardDistributorData!.parsed.rewardMint,\n        params.lastStaker,\n        true\n      )\n    : await withFindOrInitAssociatedTokenAccount(\n        transaction,\n        connection,\n        rewardDistributorData!.parsed.rewardMint,\n        params.lastStaker,\n        params.payer ?? wallet.publicKey\n      );\n\n  const remainingAccountsForKind = await withRemainingAccountsForKind(\n    transaction,\n    connection,\n    wallet,\n    rewardAuthority!,\n    rewardDistributorData!.parsed.kind,\n    rewardDistributorData!.parsed.rewardMint,\n    true\n  );\n\n  const rewardEntryId = findRewardEntryId(\n    rewardDistributorData!.pubkey,\n    params.stakeEntryId\n  );\n  const rewardEntryData = await tryGetAccount(() =>\n    getRewardEntry(connection, rewardEntryId)\n  );\n\n  const program = rewardDistributorProgram(connection, wallet);\n  if (!rewardEntryData) {\n    const ix = await program.methods\n      .initRewardEntry()\n      .accounts({\n        rewardEntry: rewardEntryId,\n        stakeEntry: params.stakeEntryId,\n        rewardDistributor: rewardDistributorData!.pubkey,\n        payer: wallet.publicKey,\n        systemProgram: SystemProgram.programId,\n      })\n      .instruction();\n    transaction.add(ix);\n  }\n\n  const ix = await program.methods\n    .claimRewards()\n    .accounts({\n      rewardEntry: rewardEntryId,\n      rewardDistributor: rewardDistributorData!.pubkey,\n      rewardAuthority,\n      stakeEntry: params.stakeEntryId,\n      stakePool: params.stakePoolId,\n      rewardMint: rewardDistributorData!.parsed.rewardMint,\n      userRewardMintTokenAccount: rewardMintTokenAccountId,\n      rewardManager: REWARD_MANAGER,\n      user: params.payer ?? wallet.publicKey,\n      tokenProgram: TOKEN_PROGRAM_ID,\n      systemProgram: SystemProgram.programId,\n    })\n    .remainingAccounts(remainingAccountsForKind)\n    .instruction();\n  transaction.add(ix);\n\n  return transaction;\n};\n\nexport const withCloseRewardDistributor = async (\n  transaction: Transaction,\n  connection: Connection,\n  wallet: Wallet,\n  params: {\n    distributorId: BN;\n    stakePoolId: PublicKey;\n  }\n): Promise<Transaction> => {\n  const rewardAuthority = findRewardAuthority(wallet.publicKey);\n  const rewardDistributorId = findRewardDistributorId(\n    params.stakePoolId,\n    params.distributorId\n  );\n  const rewardDistributorData = await tryGetAccount(() =>\n    getRewardDistributor(connection, rewardDistributorId)\n  );\n\n  if (rewardDistributorData) {\n    const remainingAccountsForKind = await withRemainingAccountsForKind(\n      transaction,\n      connection,\n      wallet,\n      rewardAuthority,\n      rewardDistributorData.parsed.kind,\n      rewardDistributorData.parsed.rewardMint\n    );\n\n    const program = rewardDistributorProgram(connection, wallet);\n    const ix = await program.methods\n      .closeRewardDistributor()\n      .accounts({\n        rewardDistributor: rewardDistributorData.pubkey,\n        rewardAuthority,\n        stakePool: params.stakePoolId,\n        rewardMint: rewardDistributorData.parsed.rewardMint,\n        signer: wallet.publicKey,\n        tokenProgram: TOKEN_PROGRAM_ID,\n      })\n      .remainingAccounts(remainingAccountsForKind)\n      .instruction();\n    transaction.add(ix);\n  }\n  return transaction;\n};\n\nexport const withUpdateRewardEntry = async (\n  transaction: Transaction,\n  connection: Connection,\n  wallet: Wallet,\n  params: {\n    stakePoolId: PublicKey;\n    rewardDistributorId: PublicKey;\n    stakeEntryId: PublicKey;\n    multiplier: BN;\n  }\n): Promise<Transaction> => {\n  const rewardAuthority = findRewardAuthority(wallet.publicKey);\n  const rewardEntryId = findRewardEntryId(\n    params.rewardDistributorId,\n    params.stakeEntryId\n  );\n  const program = rewardDistributorProgram(connection, wallet);\n  const ix = await program.methods\n    .updateRewardEntry({\n      multiplier: params.multiplier,\n    })\n    .accounts({\n      rewardEntry: rewardEntryId,\n      rewardDistributor: params.rewardDistributorId,\n      rewardAuthority,\n      authority: wallet.publicKey,\n    })\n    .instruction();\n  transaction.add(ix);\n  return transaction.add(ix);\n};\n\nexport const withCloseRewardEntry = async (\n  transaction: Transaction,\n  connection: Connection,\n  wallet: Wallet,\n  params: {\n    distributorId: BN;\n    stakePoolId: PublicKey;\n    stakeEntryId: PublicKey;\n  }\n): Promise<Transaction> => {\n  const rewardAuthority = findRewardAuthority(wallet.publicKey);\n  const rewardDistributorId = findRewardDistributorId(\n    params.stakePoolId,\n    params.distributorId\n  );\n\n  const rewardEntryId = findRewardEntryId(\n    rewardDistributorId,\n    params.stakeEntryId\n  );\n\n  const program = rewardDistributorProgram(connection, wallet);\n  const ix = await program.methods\n    .closeRewardEntry()\n    .accounts({\n      rewardAuthority,\n      rewardDistributor: rewardDistributorId,\n      rewardEntry: rewardEntryId,\n      authority: wallet.publicKey,\n    })\n    .instruction();\n  transaction.add(ix);\n  return transaction;\n};\n\nexport const withUpdateRewardDistributor = async (\n  transaction: Transaction,\n  connection: Connection,\n  wallet: Wallet,\n  params: {\n    distributorId: BN;\n    stakePoolId: PublicKey;\n    defaultMultiplier?: BN;\n    multiplierDecimals?: number;\n    rewardAmount?: BN;\n    rewardDurationSeconds?: BN;\n    maxRewardSecondsReceived?: BN;\n  }\n): Promise<Transaction> => {\n  const rewardAuthority = findRewardAuthority(wallet.publicKey);\n  const rewardDistributorId = findRewardDistributorId(\n    params.stakePoolId,\n    params.distributorId\n  );\n  const rewardDistributorData = await getRewardDistributor(\n    connection,\n    rewardDistributorId\n  );\n  const program = rewardDistributorProgram(connection, wallet);\n  const ix = await program.methods\n    .updateRewardDistributor({\n      defaultMultiplier:\n        params.defaultMultiplier ||\n        rewardDistributorData.parsed.defaultMultiplier,\n      multiplierDecimals:\n        params.multiplierDecimals ||\n        rewardDistributorData.parsed.multiplierDecimals,\n      rewardAmount:\n        params.rewardAmount || rewardDistributorData.parsed.rewardAmount,\n      rewardDurationSeconds:\n        params.rewardDurationSeconds ||\n        rewardDistributorData.parsed.rewardDurationSeconds,\n      maxRewardSecondsReceived:\n        params.maxRewardSecondsReceived ||\n        rewardDistributorData.parsed.maxRewardSecondsReceived,\n    })\n    .accounts({\n      rewardDistributor: rewardDistributorId,\n      rewardAuthority,\n      authority: wallet.publicKey,\n    })\n    .instruction();\n  transaction.add(ix);\n  return transaction;\n};\nexport const withReclaimFunds = async (\n  transaction: Transaction,\n  connection: Connection,\n  wallet: Wallet,\n  params: {\n    distributorId: BN;\n    stakePoolId: PublicKey;\n    amount: BN;\n  }\n): Promise<Transaction> => {\n  const rewardAuthority = findRewardAuthority(wallet.publicKey);\n  const rewardDistributorId = findRewardDistributorId(\n    params.stakePoolId,\n    params.distributorId\n  );\n\n  const rewardDistributorData = await tryGetAccount(() =>\n    getRewardDistributor(connection, rewardDistributorId)\n  );\n  if (!rewardDistributorData) {\n    throw new Error(\"No reward distrbutor found\");\n  }\n\n  const rewardDistributorTokenAccountId = await findAta(\n    rewardDistributorData.parsed.rewardMint,\n    rewardAuthority,\n    true\n  );\n\n  const authorityTokenAccountId = await withFindOrInitAssociatedTokenAccount(\n    transaction,\n    connection,\n    rewardDistributorData.parsed.rewardMint,\n    wallet.publicKey,\n    wallet.publicKey,\n    true\n  );\n\n  const program = rewardDistributorProgram(connection, wallet);\n  const ix = await program.methods\n    .reclaimFunds(params.amount)\n    .accounts({\n      rewardDistributor: rewardDistributorId,\n      rewardAuthority,\n      rewardDistributorTokenAccount: rewardDistributorTokenAccountId,\n      authorityTokenAccount: authorityTokenAccountId,\n      authority: wallet.publicKey,\n      tokenProgram: TOKEN_PROGRAM_ID,\n    })\n    .instruction();\n  transaction.add(ix);\n  return transaction;\n};\n"]}